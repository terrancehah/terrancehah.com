<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="../../styles/output.css" rel="stylesheet">
    <link href="../../styles/style.css" type="text/css" rel="stylesheet">
    <link rel="icon" href="../../resources/TH-logo.png" type="image/x-icon">
    <title>Persona Result - Terrance's Playground</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&family=Raleway:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap');
        
        .result-container {
            background: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .result-card {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 24px;
            margin-bottom: 24px;
        }
        .result-label {
            font-weight: 700;
            color: #1d3557;
            margin-bottom: 8px;
            font-size: 16px;
        }
        .result-content {
            font-size: 16px;
            line-height: 1.6;
            color: #333;
            white-space: pre-line;
        }
        .timestamp {
            font-size: 12px;
            color: #6c757d;
            text-align: right;
            margin-top: 8px;
        }
        .back-button {
            display: inline-block;
            padding: 12px 24px;
            background-color: #457B9D;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            font-weight: 600;
            transition: background-color 0.3s;
        }
        .back-button:hover {
            background-color: #1d3557;
        }
    </style>
</head>
<body class="m-0 relative h-full bg-white overflow-x-hidden font-lato">
    <header class="w-full inline-block">
        <div class="flex flex-col lg:flex-row justify-between items-center p-2.5 sm:p-3">
            <!-- Left: Title -->
            <div class="flex flex-col lg:flex-row items-center w-auto md:w-[300px] gap-1">
                <h1 class="font-lato font-semibold text-[#1d3557] text-2xl md:text-3xl p-0 text-center sm:text-left sm:w-auto">
                    Terrance's Playground
                </h1>
            </div>

            <!-- Middle: Nav buttons -->
            <nav class="flex flex-wrap justify-center gap-2">
                <a href="../../index.html" class="relative p-2 font-raleway font-medium text-lg md:text-xl text-sky-blue hover:bg-light-blue">Home</a>
                <a href="../../articles.html" class="relative p-2 font-raleway font-medium text-lg md:text-xl text-sky-blue hover:bg-light-blue">Articles</a>
                <a href="../../projects.html" class="relative p-2 font-raleway font-medium text-lg md:text-xl text-sky-blue hover:bg-light-blue bg-light-blue">Projects</a>
                <a href="../../playground.html" class="relative p-2 font-raleway font-medium text-lg md:text-xl text-sky-blue hover:bg-light-blue">Playground</a>
            </nav>
        
            <!-- Right side: Social Icons -->
            <div class="flex items-center gap-4 md:gap-3 mt-2 lg:w-[300px] justify-end lg:mt-0">
                <a href="https://facebook.com/terrancehah/" target="_blank" class="w-8 h-8">
                    <img src="../../resources/facebook.png" alt="facebook" class="w-full h-full">
                </a>
                <a href="https://instagram.com/terrancehah/" target="_blank" class="w-8 h-8">
                    <img src="../../resources/instagram.png" alt="instagram" class="w-full h-full">
                </a>
                <a href="https://x.com/terrance_hah" target="_blank" class="w-8 h-8">
                    <img src="../../resources/x.png" alt="x" class="w-full h-full">
                </a>
                <a href="https://www.linkedin.com/in/terrancehah/" target="_blank" class="w-8 h-8">
                    <img src="../../resources/linkedin.png" alt="linkedin" class="w-full h-full">
                </a>
                <a href="https://github.com/terrancehah" target="_blank" class="w-8 h-8">
                    <img src="../../resources/github.png" alt="github" class="w-full h-full">
                </a>
            </div>
        </div>
    </header>

    <main class="w-full px-4 md:px-8 lg:px-16 xl:px-32 py-8 max-w-screen-2xl mx-auto">
        <div class="result-container max-w-3xl mx-auto">
            <h1 class="font-lato font-bold text-3xl text-[#1d3557] text-center mb-8">Persona Result</h1>
            
            <div class="result-card">
                <div class="result-label">Student Summary:</div>
                <div class="result-content">{{ student_text }}</div>
            </div>

            <div class="result-card">
                <div class="result-label">AI Generated Persona & Learning Strategy:</div>
                <div id="persona-content" class="result-content">
                    <div id="loading-indicator" style="display: flex; align-items: center; gap: 10px; color: #666;">
                        <div class="spinner" style="width: 20px; height: 20px; border: 3px solid #f3f3f3; border-top: 3px solid #457B9D; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                        Generating persona... This may take a few seconds.
                    </div>
                </div>
                <div class="timestamp">Generated on: {{ timestamp }}</div>
            </div>

            <div class="text-center mt-8">
                <a href="/projects/fastapi-experiment/" class="back-button">Generate Another Persona</a>
            </div>
        </div>
    </main>

    <script src="../../js/footer.js"></script>

    <style>
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>

    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            const studentText = document.querySelector('.result-content').innerText.trim();
            const contentDiv = document.getElementById('persona-content');
            const loadingDiv = document.getElementById('loading-indicator');
            
            try {
                const response = await fetch('/api/generate-stream', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ text_summary: studentText })
                });

                if (!response.ok) throw new Error('Network response was not ok');

                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                
                // Clear loading indicator once data starts coming
                let firstChunk = true;

                while (true) {
                    const { done, value } = await reader.read();
                    
                    if (done) break;
                    
                    if (firstChunk) {
                        loadingDiv.remove();
                        firstChunk = false;
                    }

                    const text = decoder.decode(value);
                    contentDiv.textContent += text;
                }
            } catch (error) {
                loadingDiv.innerHTML = `<span style="color: #e63946;">Error generating persona: ${error.message}</span>`;
            }
        });
    </script>
</body>
</html>
