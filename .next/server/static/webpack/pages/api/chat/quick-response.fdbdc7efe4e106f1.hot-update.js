"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("pages/api/chat/quick-response",{

/***/ "(middleware)/./managers/stage-manager.ts":
/*!***********************************!*\
  !*** ./managers/stage-manager.ts ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   STAGE_LIMITS: () => (/* binding */ STAGE_LIMITS),\n/* harmony export */   validateStageProgression: () => (/* binding */ validateStageProgression)\n/* harmony export */ });\n/* harmony import */ var _utils_session_manager__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../utils/session-manager */ \"(middleware)/./utils/session-manager.ts\");\n\n// Validation functions for each stage\nconst STAGE_LIMITS = {\n    3: {\n        maxPrompts: 5,\n        upgradeMessage: `I'm sorry to tell you that you have reached the prompts limit in the free version. \n    Would you like to upgrade to unlock unlimited places browsing and premium features? \n    This will give you access to personalized recommendations, detailed scheduling, and local insights.`\n    }\n};\nconst STAGE_VALIDATORS = {\n    // Stage 1: Initial Parameter Check\n    1: {\n        validate: (details)=>{\n            const missingRequirements = [];\n            if (!details.destination) missingRequirements.push(\"destination\");\n            if (!details.startDate) missingRequirements.push(\"start date\");\n            if (!details.endDate) missingRequirements.push(\"end date\");\n            if (!details.preferences?.length) missingRequirements.push(\"preferences\");\n            if (!details.language) missingRequirements.push(\"language\");\n            return {\n                isValid: missingRequirements.length === 0,\n                missingRequirements\n            };\n        }\n    },\n    // Stage 2: City Introduction\n    2: {\n        validate: (details, session)=>{\n            return {\n                isValid: true,\n                missingRequirements: []\n            };\n        }\n    },\n    // Stage 3: Places Introduction\n    3: {\n        validate: (details, session)=>{\n            const { totalPrompts, stagePrompts, savedPlaces } = session;\n            const stagePromptCount = stagePrompts?.[3] || 0;\n            const upgradeRequired = !session.isPaid && stagePromptCount >= STAGE_LIMITS[3].maxPrompts;\n            // Check if we have enough places saved\n            const minPlacesRequired = 3;\n            const hasEnoughPlaces = savedPlaces.length >= minPlacesRequired;\n            // Check if we have diverse place types based on preferences\n            const placeTypes = new Set(savedPlaces.map((p)=>p.primaryType));\n            const hasGoodCoverage = placeTypes.size >= Math.min(2, details.preferences.length);\n            const missingRequirements = [];\n            if (!hasEnoughPlaces) {\n                missingRequirements.push(`at least ${minPlacesRequired} places`);\n            }\n            if (!hasGoodCoverage) {\n                missingRequirements.push(\"more diverse place types\");\n            }\n            return {\n                isValid: !upgradeRequired && hasEnoughPlaces && hasGoodCoverage,\n                missingRequirements,\n                upgradeRequired\n            };\n        }\n    },\n    // Stage 4: Itinerary Review (with payment check)\n    4: {\n        validate: (details, session)=>{\n            const { isPaid, savedPlaces } = session;\n            const missingRequirements = [];\n            // Check payment status\n            if (!isPaid) {\n                missingRequirements.push(\"premium subscription\");\n            }\n            // Check minimum places for a good itinerary\n            const minPlacesForItinerary = 5;\n            if (savedPlaces.length < minPlacesForItinerary) {\n                missingRequirements.push(`at least ${minPlacesForItinerary} places`);\n            }\n            // Check place type distribution\n            const placeTypes = new Set(savedPlaces.map((p)=>p.primaryType));\n            const minPlaceTypes = Math.min(3, details.preferences.length);\n            if (placeTypes.size < minPlaceTypes) {\n                missingRequirements.push(\"more diverse place types\");\n            }\n            return {\n                isValid: missingRequirements.length === 0,\n                missingRequirements,\n                upgradeRequired: !isPaid\n            };\n        }\n    },\n    // Stage 5: Final Confirmation (keeping it open as requested)\n    5: {\n        validate: (_, session)=>{\n            const isPaid = session.isPaid;\n            return {\n                isValid: isPaid,\n                missingRequirements: isPaid ? [] : [\n                    \"premium subscription\"\n                ],\n                upgradeRequired: !isPaid\n            };\n        }\n    }\n};\n// Main validation function to be used in the chat component\nfunction validateStageProgression(currentStage, nextStage, travelDetails) {\n    let session = (0,_utils_session_manager__WEBPACK_IMPORTED_MODULE_0__.getStoredSession)();\n    // If no session exists but we have travel details, initialize one\n    if (!session && travelDetails.destination) {\n        session = (0,_utils_session_manager__WEBPACK_IMPORTED_MODULE_0__.initializeSession)();\n        session.destination = travelDetails.destination;\n        session.startDate = travelDetails.startDate || \"\";\n        session.endDate = travelDetails.endDate || \"\";\n        session.preferences = travelDetails.preferences || [];\n        session.budget = travelDetails.budget || \"\";\n        session.language = travelDetails.language || \"\";\n        session.transport = travelDetails.transport || [];\n        session.currentStage = currentStage;\n    }\n    if (!session) {\n        return {\n            canProgress: false,\n            missingRequirements: [\n                \"valid session\"\n            ]\n        };\n    }\n    // Ensure stage progression is sequential\n    if (nextStage !== currentStage + 1) {\n        return {\n            canProgress: false,\n            missingRequirements: [\n                \"invalid stage progression\"\n            ]\n        };\n    }\n    // Get validator for next stage\n    const validator = STAGE_VALIDATORS[nextStage];\n    if (!validator) {\n        return {\n            canProgress: true,\n            missingRequirements: []\n        };\n    }\n    // Check if we can move to next stage\n    const { isValid, missingRequirements, upgradeRequired } = validator.validate(travelDetails, session);\n    return {\n        canProgress: isValid,\n        missingRequirements,\n        upgradeRequired\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUN6QjtJQUVBLElBQUksQ0FBQ3RCLFNBQVM7UUFDWixPQUFPO1lBQ0wyQixhQUFhO1lBQ2JwQyxxQkFBcUI7Z0JBQUM7YUFBZ0I7UUFDeEM7SUFDRjtJQUVBLHlDQUF5QztJQUN6QyxJQUFJZ0MsY0FBY0QsZUFBZSxHQUFHO1FBQ2xDLE9BQU87WUFDTEssYUFBYTtZQUNicEMscUJBQXFCO2dCQUFDO2FBQTRCO1FBQ3BEO0lBQ0Y7SUFFQSwrQkFBK0I7SUFDL0IsTUFBTXFDLFlBQVl4QyxnQkFBZ0IsQ0FBQ21DLFVBQVU7SUFDN0MsSUFBSSxDQUFDSyxXQUFXO1FBQ2QsT0FBTztZQUNMRCxhQUFhO1lBQ2JwQyxxQkFBcUIsRUFBRTtRQUN6QjtJQUNGO0lBRUEscUNBQXFDO0lBQ3JDLE1BQU0sRUFBRVEsT0FBTyxFQUFFUixtQkFBbUIsRUFBRWMsZUFBZSxFQUFFLEdBQUd1QixVQUFVdkMsUUFBUSxDQUMxRW1DLGVBQ0F4QjtJQUdGLE9BQU87UUFDTDJCLGFBQWE1QjtRQUNiUjtRQUNBYztJQUNGO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9fTl9FLy4vbWFuYWdlcnMvc3RhZ2UtbWFuYWdlci50cz8yYWRhIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFRyYXZlbERldGFpbHMsIFRyYXZlbFNlc3Npb24gfSBmcm9tICcuL3R5cGVzJztcbmltcG9ydCB7IGdldFN0b3JlZFNlc3Npb24sIGluaXRpYWxpemVTZXNzaW9uIH0gZnJvbSAnLi4vdXRpbHMvc2Vzc2lvbi1tYW5hZ2VyJztcblxuLy8gSW50ZXJmYWNlIGZvciB0cmFja2luZyB1c2VyIGludGVyYWN0aW9uc1xuLy8gZXhwb3J0IGludGVyZmFjZSBVc2VySW50ZXJhY3Rpb25NZXRyaWNzIHtcbi8vICAgdG90YWxQcm9tcHRzOiBudW1iZXI7XG4vLyAgIHNhdmVkUGxhY2VzQ291bnQ6IG51bWJlcjtcbi8vICAgaXNQYWlkOiBib29sZWFuO1xuLy8gICBzdGFnZVByb21wdHM/OiBSZWNvcmQ8bnVtYmVyLCBudW1iZXI+O1xuLy8gICBwYXltZW50UmVmZXJlbmNlOiBzdHJpbmc7IC8vIFRyYWNrIHBheW1lbnQgcmVmZXJlbmNlIElEIC0gcmVxdWlyZWRcbi8vIH1cblxuLy8gRGVmaW5lIHJlcXVpcmVtZW50cyBmb3IgZWFjaCBzdGFnZVxuaW50ZXJmYWNlIFN0YWdlUmVxdWlyZW1lbnRzIHtcbiAgdmFsaWRhdGU6IChcbiAgICB0cmF2ZWxEZXRhaWxzOiBUcmF2ZWxEZXRhaWxzLFxuICAgIHNlc3Npb246IFRyYXZlbFNlc3Npb25cbiAgKSA9PiB7XG4gICAgaXNWYWxpZDogYm9vbGVhbjtcbiAgICBtaXNzaW5nUmVxdWlyZW1lbnRzOiBzdHJpbmdbXTtcbiAgICB1cGdyYWRlUmVxdWlyZWQ/OiBib29sZWFuO1xuICB9O1xufVxuXG4vLyBWYWxpZGF0aW9uIGZ1bmN0aW9ucyBmb3IgZWFjaCBzdGFnZVxuZXhwb3J0IGNvbnN0IFNUQUdFX0xJTUlUUyA9IHtcbiAgMzoge1xuICAgIG1heFByb21wdHM6IDUsXG4gICAgdXBncmFkZU1lc3NhZ2U6IGBJJ20gc29ycnkgdG8gdGVsbCB5b3UgdGhhdCB5b3UgaGF2ZSByZWFjaGVkIHRoZSBwcm9tcHRzIGxpbWl0IGluIHRoZSBmcmVlIHZlcnNpb24uIFxuICAgIFdvdWxkIHlvdSBsaWtlIHRvIHVwZ3JhZGUgdG8gdW5sb2NrIHVubGltaXRlZCBwbGFjZXMgYnJvd3NpbmcgYW5kIHByZW1pdW0gZmVhdHVyZXM/IFxuICAgIFRoaXMgd2lsbCBnaXZlIHlvdSBhY2Nlc3MgdG8gcGVyc29uYWxpemVkIHJlY29tbWVuZGF0aW9ucywgZGV0YWlsZWQgc2NoZWR1bGluZywgYW5kIGxvY2FsIGluc2lnaHRzLmBcbiAgfVxufSBhcyBjb25zdDtcblxuY29uc3QgU1RBR0VfVkFMSURBVE9SUzogUmVjb3JkPG51bWJlciwgU3RhZ2VSZXF1aXJlbWVudHM+ID0ge1xuICAvLyBTdGFnZSAxOiBJbml0aWFsIFBhcmFtZXRlciBDaGVja1xuICAxOiB7XG4gICAgdmFsaWRhdGU6IChkZXRhaWxzOiBUcmF2ZWxEZXRhaWxzKSA9PiB7XG4gICAgICBjb25zdCBtaXNzaW5nUmVxdWlyZW1lbnRzOiBzdHJpbmdbXSA9IFtdO1xuICAgICAgXG4gICAgICBpZiAoIWRldGFpbHMuZGVzdGluYXRpb24pIG1pc3NpbmdSZXF1aXJlbWVudHMucHVzaCgnZGVzdGluYXRpb24nKTtcbiAgICAgIGlmICghZGV0YWlscy5zdGFydERhdGUpIG1pc3NpbmdSZXF1aXJlbWVudHMucHVzaCgnc3RhcnQgZGF0ZScpO1xuICAgICAgaWYgKCFkZXRhaWxzLmVuZERhdGUpIG1pc3NpbmdSZXF1aXJlbWVudHMucHVzaCgnZW5kIGRhdGUnKTtcbiAgICAgIGlmICghZGV0YWlscy5wcmVmZXJlbmNlcz8ubGVuZ3RoKSBtaXNzaW5nUmVxdWlyZW1lbnRzLnB1c2goJ3ByZWZlcmVuY2VzJyk7XG4gICAgICBpZiAoIWRldGFpbHMubGFuZ3VhZ2UpIG1pc3NpbmdSZXF1aXJlbWVudHMucHVzaCgnbGFuZ3VhZ2UnKTtcbiAgICAgIFxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgaXNWYWxpZDogbWlzc2luZ1JlcXVpcmVtZW50cy5sZW5ndGggPT09IDAsXG4gICAgICAgIG1pc3NpbmdSZXF1aXJlbWVudHNcbiAgICAgIH07XG4gICAgfVxuICB9LFxuXG4gIC8vIFN0YWdlIDI6IENpdHkgSW50cm9kdWN0aW9uXG4gIDI6IHtcbiAgICB2YWxpZGF0ZTogKGRldGFpbHM6IFRyYXZlbERldGFpbHMsIHNlc3Npb246IFRyYXZlbFNlc3Npb24pID0+IHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlzVmFsaWQ6IHRydWUsXG4gICAgICAgIG1pc3NpbmdSZXF1aXJlbWVudHM6IFtdXG4gICAgICB9O1xuICAgIH1cbiAgfSxcblxuICAvLyBTdGFnZSAzOiBQbGFjZXMgSW50cm9kdWN0aW9uXG4gIDM6IHtcbiAgICB2YWxpZGF0ZTogKGRldGFpbHM6IFRyYXZlbERldGFpbHMsIHNlc3Npb246IFRyYXZlbFNlc3Npb24pID0+IHtcbiAgICAgIGNvbnN0IHsgdG90YWxQcm9tcHRzLCBzdGFnZVByb21wdHMsIHNhdmVkUGxhY2VzIH0gPSBzZXNzaW9uO1xuICAgICAgY29uc3Qgc3RhZ2VQcm9tcHRDb3VudCA9IHN0YWdlUHJvbXB0cz8uWzNdIHx8IDA7XG4gICAgICBjb25zdCB1cGdyYWRlUmVxdWlyZWQgPSAhc2Vzc2lvbi5pc1BhaWQgJiYgc3RhZ2VQcm9tcHRDb3VudCA+PSBTVEFHRV9MSU1JVFNbM10ubWF4UHJvbXB0cztcblxuICAgICAgLy8gQ2hlY2sgaWYgd2UgaGF2ZSBlbm91Z2ggcGxhY2VzIHNhdmVkXG4gICAgICBjb25zdCBtaW5QbGFjZXNSZXF1aXJlZCA9IDM7XG4gICAgICBjb25zdCBoYXNFbm91Z2hQbGFjZXMgPSBzYXZlZFBsYWNlcy5sZW5ndGggPj0gbWluUGxhY2VzUmVxdWlyZWQ7XG5cbiAgICAgIC8vIENoZWNrIGlmIHdlIGhhdmUgZGl2ZXJzZSBwbGFjZSB0eXBlcyBiYXNlZCBvbiBwcmVmZXJlbmNlc1xuICAgICAgY29uc3QgcGxhY2VUeXBlcyA9IG5ldyBTZXQoc2F2ZWRQbGFjZXMubWFwKHAgPT4gcC5wcmltYXJ5VHlwZSkpO1xuICAgICAgY29uc3QgaGFzR29vZENvdmVyYWdlID0gcGxhY2VUeXBlcy5zaXplID49IE1hdGgubWluKDIsIGRldGFpbHMucHJlZmVyZW5jZXMubGVuZ3RoKTtcblxuICAgICAgY29uc3QgbWlzc2luZ1JlcXVpcmVtZW50czogc3RyaW5nW10gPSBbXTtcbiAgICAgIGlmICghaGFzRW5vdWdoUGxhY2VzKSB7XG4gICAgICAgIG1pc3NpbmdSZXF1aXJlbWVudHMucHVzaChgYXQgbGVhc3QgJHttaW5QbGFjZXNSZXF1aXJlZH0gcGxhY2VzYCk7XG4gICAgICB9XG4gICAgICBpZiAoIWhhc0dvb2RDb3ZlcmFnZSkge1xuICAgICAgICBtaXNzaW5nUmVxdWlyZW1lbnRzLnB1c2goJ21vcmUgZGl2ZXJzZSBwbGFjZSB0eXBlcycpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBpc1ZhbGlkOiAhdXBncmFkZVJlcXVpcmVkICYmIGhhc0Vub3VnaFBsYWNlcyAmJiBoYXNHb29kQ292ZXJhZ2UsXG4gICAgICAgIG1pc3NpbmdSZXF1aXJlbWVudHMsXG4gICAgICAgIHVwZ3JhZGVSZXF1aXJlZFxuICAgICAgfTtcbiAgICB9XG4gIH0sXG5cbiAgLy8gU3RhZ2UgNDogSXRpbmVyYXJ5IFJldmlldyAod2l0aCBwYXltZW50IGNoZWNrKVxuICA0OiB7XG4gICAgdmFsaWRhdGU6IChkZXRhaWxzOiBUcmF2ZWxEZXRhaWxzLCBzZXNzaW9uOiBUcmF2ZWxTZXNzaW9uKSA9PiB7XG4gICAgICBjb25zdCB7IGlzUGFpZCwgc2F2ZWRQbGFjZXMgfSA9IHNlc3Npb247XG4gICAgICBjb25zdCBtaXNzaW5nUmVxdWlyZW1lbnRzOiBzdHJpbmdbXSA9IFtdO1xuXG4gICAgICAvLyBDaGVjayBwYXltZW50IHN0YXR1c1xuICAgICAgaWYgKCFpc1BhaWQpIHtcbiAgICAgICAgbWlzc2luZ1JlcXVpcmVtZW50cy5wdXNoKCdwcmVtaXVtIHN1YnNjcmlwdGlvbicpO1xuICAgICAgfVxuXG4gICAgICAvLyBDaGVjayBtaW5pbXVtIHBsYWNlcyBmb3IgYSBnb29kIGl0aW5lcmFyeVxuICAgICAgY29uc3QgbWluUGxhY2VzRm9ySXRpbmVyYXJ5ID0gNTtcbiAgICAgIGlmIChzYXZlZFBsYWNlcy5sZW5ndGggPCBtaW5QbGFjZXNGb3JJdGluZXJhcnkpIHtcbiAgICAgICAgbWlzc2luZ1JlcXVpcmVtZW50cy5wdXNoKGBhdCBsZWFzdCAke21pblBsYWNlc0Zvckl0aW5lcmFyeX0gcGxhY2VzYCk7XG4gICAgICB9XG5cbiAgICAgIC8vIENoZWNrIHBsYWNlIHR5cGUgZGlzdHJpYnV0aW9uXG4gICAgICBjb25zdCBwbGFjZVR5cGVzID0gbmV3IFNldChzYXZlZFBsYWNlcy5tYXAocCA9PiBwLnByaW1hcnlUeXBlKSk7XG4gICAgICBjb25zdCBtaW5QbGFjZVR5cGVzID0gTWF0aC5taW4oMywgZGV0YWlscy5wcmVmZXJlbmNlcy5sZW5ndGgpO1xuICAgICAgaWYgKHBsYWNlVHlwZXMuc2l6ZSA8IG1pblBsYWNlVHlwZXMpIHtcbiAgICAgICAgbWlzc2luZ1JlcXVpcmVtZW50cy5wdXNoKCdtb3JlIGRpdmVyc2UgcGxhY2UgdHlwZXMnKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgaXNWYWxpZDogbWlzc2luZ1JlcXVpcmVtZW50cy5sZW5ndGggPT09IDAsXG4gICAgICAgIG1pc3NpbmdSZXF1aXJlbWVudHMsXG4gICAgICAgIHVwZ3JhZGVSZXF1aXJlZDogIWlzUGFpZFxuICAgICAgfTtcbiAgICB9XG4gIH0sXG5cbiAgLy8gU3RhZ2UgNTogRmluYWwgQ29uZmlybWF0aW9uIChrZWVwaW5nIGl0IG9wZW4gYXMgcmVxdWVzdGVkKVxuICA1OiB7XG4gICAgdmFsaWRhdGU6IChfLCBzZXNzaW9uOiBUcmF2ZWxTZXNzaW9uKSA9PiB7XG4gICAgICBjb25zdCBpc1BhaWQgPSBzZXNzaW9uLmlzUGFpZDtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlzVmFsaWQ6IGlzUGFpZCxcbiAgICAgICAgbWlzc2luZ1JlcXVpcmVtZW50czogaXNQYWlkID8gW10gOiBbJ3ByZW1pdW0gc3Vic2NyaXB0aW9uJ10sXG4gICAgICAgIHVwZ3JhZGVSZXF1aXJlZDogIWlzUGFpZFxuICAgICAgfTtcbiAgICB9XG4gIH1cbn07XG5cbi8vIE1haW4gdmFsaWRhdGlvbiBmdW5jdGlvbiB0byBiZSB1c2VkIGluIHRoZSBjaGF0IGNvbXBvbmVudFxuZXhwb3J0IGZ1bmN0aW9uIHZhbGlkYXRlU3RhZ2VQcm9ncmVzc2lvbihcbiAgY3VycmVudFN0YWdlOiBudW1iZXIsXG4gIG5leHRTdGFnZTogbnVtYmVyLFxuICB0cmF2ZWxEZXRhaWxzOiBUcmF2ZWxEZXRhaWxzXG4pOiB7XG4gIGNhblByb2dyZXNzOiBib29sZWFuO1xuICBtaXNzaW5nUmVxdWlyZW1lbnRzOiBzdHJpbmdbXTtcbiAgdXBncmFkZVJlcXVpcmVkPzogYm9vbGVhbjtcbn0ge1xuICBsZXQgc2Vzc2lvbiA9IGdldFN0b3JlZFNlc3Npb24oKTtcbiAgXG4gIC8vIElmIG5vIHNlc3Npb24gZXhpc3RzIGJ1dCB3ZSBoYXZlIHRyYXZlbCBkZXRhaWxzLCBpbml0aWFsaXplIG9uZVxuICBpZiAoIXNlc3Npb24gJiYgdHJhdmVsRGV0YWlscy5kZXN0aW5hdGlvbikge1xuICAgIHNlc3Npb24gPSBpbml0aWFsaXplU2Vzc2lvbigpO1xuICAgIHNlc3Npb24uZGVzdGluYXRpb24gPSB0cmF2ZWxEZXRhaWxzLmRlc3RpbmF0aW9uO1xuICAgIHNlc3Npb24uc3RhcnREYXRlID0gdHJhdmVsRGV0YWlscy5zdGFydERhdGUgfHwgJyc7XG4gICAgc2Vzc2lvbi5lbmREYXRlID0gdHJhdmVsRGV0YWlscy5lbmREYXRlIHx8ICcnO1xuICAgIHNlc3Npb24ucHJlZmVyZW5jZXMgPSB0cmF2ZWxEZXRhaWxzLnByZWZlcmVuY2VzIHx8IFtdO1xuICAgIHNlc3Npb24uYnVkZ2V0ID0gdHJhdmVsRGV0YWlscy5idWRnZXQgfHwgJyc7XG4gICAgc2Vzc2lvbi5sYW5ndWFnZSA9IHRyYXZlbERldGFpbHMubGFuZ3VhZ2UgfHwgJyc7XG4gICAgc2Vzc2lvbi50cmFuc3BvcnQgPSB0cmF2ZWxEZXRhaWxzLnRyYW5zcG9ydCB8fCBbXTtcbiAgICBzZXNzaW9uLmN1cnJlbnRTdGFnZSA9IGN1cnJlbnRTdGFnZTtcbiAgfVxuXG4gIGlmICghc2Vzc2lvbikge1xuICAgIHJldHVybiB7XG4gICAgICBjYW5Qcm9ncmVzczogZmFsc2UsXG4gICAgICBtaXNzaW5nUmVxdWlyZW1lbnRzOiBbJ3ZhbGlkIHNlc3Npb24nXVxuICAgIH07XG4gIH1cblxuICAvLyBFbnN1cmUgc3RhZ2UgcHJvZ3Jlc3Npb24gaXMgc2VxdWVudGlhbFxuICBpZiAobmV4dFN0YWdlICE9PSBjdXJyZW50U3RhZ2UgKyAxKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGNhblByb2dyZXNzOiBmYWxzZSxcbiAgICAgIG1pc3NpbmdSZXF1aXJlbWVudHM6IFsnaW52YWxpZCBzdGFnZSBwcm9ncmVzc2lvbiddXG4gICAgfTtcbiAgfVxuXG4gIC8vIEdldCB2YWxpZGF0b3IgZm9yIG5leHQgc3RhZ2VcbiAgY29uc3QgdmFsaWRhdG9yID0gU1RBR0VfVkFMSURBVE9SU1tuZXh0U3RhZ2VdO1xuICBpZiAoIXZhbGlkYXRvcikge1xuICAgIHJldHVybiB7XG4gICAgICBjYW5Qcm9ncmVzczogdHJ1ZSxcbiAgICAgIG1pc3NpbmdSZXF1aXJlbWVudHM6IFtdXG4gICAgfTtcbiAgfVxuXG4gIC8vIENoZWNrIGlmIHdlIGNhbiBtb3ZlIHRvIG5leHQgc3RhZ2VcbiAgY29uc3QgeyBpc1ZhbGlkLCBtaXNzaW5nUmVxdWlyZW1lbnRzLCB1cGdyYWRlUmVxdWlyZWQgfSA9IHZhbGlkYXRvci52YWxpZGF0ZShcbiAgICB0cmF2ZWxEZXRhaWxzLFxuICAgIHNlc3Npb25cbiAgKTtcblxuICByZXR1cm4ge1xuICAgIGNhblByb2dyZXNzOiBpc1ZhbGlkLFxuICAgIG1pc3NpbmdSZXF1aXJlbWVudHMsXG4gICAgdXBncmFkZVJlcXVpcmVkXG4gIH07XG59XG4iXSwibmFtZXMiOlsiZ2V0U3RvcmVkU2Vzc2lvbiIsImluaXRpYWxpemVTZXNzaW9uIiwiU1RBR0VfTElNSVRTIiwibWF4UHJvbXB0cyIsInVwZ3JhZGVNZXNzYWdlIiwiU1RBR0VfVkFMSURBVE9SUyIsInZhbGlkYXRlIiwiZGV0YWlscyIsIm1pc3NpbmdSZXF1aXJlbWVudHMiLCJkZXN0aW5hdGlvbiIsInB1c2giLCJzdGFydERhdGUiLCJlbmREYXRlIiwicHJlZmVyZW5jZXMiLCJsZW5ndGgiLCJsYW5ndWFnZSIsImlzVmFsaWQiLCJzZXNzaW9uIiwidG90YWxQcm9tcHRzIiwic3RhZ2VQcm9tcHRzIiwic2F2ZWRQbGFjZXMiLCJzdGFnZVByb21wdENvdW50IiwidXBncmFkZVJlcXVpcmVkIiwiaXNQYWlkIiwibWluUGxhY2VzUmVxdWlyZWQiLCJoYXNFbm91Z2hQbGFjZXMiLCJwbGFjZVR5cGVzIiwiU2V0IiwibWFwIiwicCIsInByaW1hcnlUeXBlIiwiaGFzR29vZENvdmVyYWdlIiwic2l6ZSIsIk1hdGgiLCJtaW4iLCJtaW5QbGFjZXNGb3JJdGluZXJhcnkiLCJtaW5QbGFjZVR5cGVzIiwiXyIsInZhbGlkYXRlU3RhZ2VQcm9ncmVzc2lvbiIsImN1cnJlbnRTdGFnZSIsIm5leHRTdGFnZSIsInRyYXZlbERldGFpbHMiLCJidWRnZXQiLCJ0cmFuc3BvcnQiLCJjYW5Qcm9ncmVzcyIsInZhbGlkYXRvciJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(middleware)/./managers/stage-manager.ts\n");

/***/ })

});