"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("pages/api/chat",{

/***/ "(middleware)/./pages/api/chat/index.ts":
/*!*********************************!*\
  !*** ./pages/api/chat/index.ts ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (/* binding */ handler),\n/* harmony export */   maxDuration: () => (/* binding */ maxDuration)\n/* harmony export */ });\n/* harmony import */ var _ai_sdk_openai__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @ai-sdk/openai */ \"(middleware)/./node_modules/@ai-sdk/openai/dist/index.mjs\");\n/* harmony import */ var ai__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ai */ \"(middleware)/./node_modules/ai/dist/index.mjs\");\n/* harmony import */ var _ai_tools__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../ai/tools */ \"(middleware)/./ai/tools.ts\");\n/* harmony import */ var _managers_stage_manager__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../managers/stage-manager */ \"(middleware)/./managers/stage-manager.ts\");\n\n\n\n\nconst config = {\n    runtime: \"edge\"\n};\n// Allow streaming responses up to 40 seconds\nconst maxDuration = 40;\nasync function handler(req) {\n    if (req.method !== \"POST\") {\n        return new Response(\"Method not allowed\", {\n            status: 405\n        });\n    }\n    try {\n        const { messages, currentDetails, savedPlaces, currentStage, metrics } = await req.json();\n        console.log(\"Debug - API received:\", {\n            currentDetails,\n            savedPlaces,\n            currentStage,\n            metrics,\n            message: messages[messages.length - 1]\n        });\n        console.log(\"[chat] Processing request:\", {\n            messageCount: messages.length,\n            destination: currentDetails.destination\n        });\n        // Check stage limits and append upgrade message if needed\n        if (currentStage === 3 && metrics?.stagePrompts?.[3] >= _managers_stage_manager__WEBPACK_IMPORTED_MODULE_1__.STAGE_LIMITS[3].maxPrompts) {\n            const stream = await (0,ai__WEBPACK_IMPORTED_MODULE_2__.streamText)({\n                model: (0,_ai_sdk_openai__WEBPACK_IMPORTED_MODULE_3__.openai)(\"gpt-4o-mini\"),\n                messages: [\n                    {\n                        role: \"assistant\",\n                        content: _managers_stage_manager__WEBPACK_IMPORTED_MODULE_1__.STAGE_LIMITS[3].upgradeMessage\n                    }\n                ],\n                maxTokens: 500,\n                temperature: 0.7,\n                experimental_transform: (0,ai__WEBPACK_IMPORTED_MODULE_2__.smoothStream)({\n                    delayInMs: 70\n                })\n            });\n            return stream.toDataStreamResponse();\n        }\n        // Validate request and required fields\n        if (!messages?.length || !currentDetails || !metrics) {\n            return new Response(JSON.stringify({\n                error: \"Invalid request: messages, currentDetails, and metrics are required\"\n            }), {\n                status: 400\n            });\n        }\n        // Validate currentDetails fields\n        if (!currentDetails.destination) {\n            return new Response(JSON.stringify({\n                error: \"Invalid request: destination is required\"\n            }), {\n                status: 400\n            });\n        }\n        const staticSystemPrompt = `You are Travel-Rizz, a friendly and helpful travel assistant guiding users through 5 stages of trip planning.\n    \n\n    # Travel-Rizz Itinerary Planner AI Framework - Comprehensive Guide\n\n    ## 1.0 Core Setup\n\n    You as an itinerary planner processes a few key 'MESSAGE PARAMETERS' from each user message: 'currentDetails', 'savedPlaces', and 'currentStage'. \n    The 'currentDetails' parameter encompasses the user's travel specifications, including their chosen destination, travel dates, budget allocation, specific preferences, and itinerary language. \n    The 'savedPlaces' parameter maintains an array of locations that the system automatically stores when the place browsing tools - 'carousel' or 'placeCard' - are called. \n    The 'currentStage' parameter tracks the user's progress through the 5-stage planning process, they are:\n    - INITIAL PARAMETER CHECK (Stage 1)\n    - CITY INTRODUCTION (Stage 2)\n    - PLACES BROWSING AND INTRODUCTION (Stage 3)\n    - ITINERARY REVIEW (Stage 4)\n    - FINAL CONFIRMATION (Stage 5)\n\n    Your ultimate goal is to maintain fluid conversation flow while guiding users through their trip planning journey.\n    Focus on providing information and asking questions, but NEVER provide options for users to choose from.\n    There is another AI, Quick-Rizz, that will provide suitable options for users to choose from based on your responses. \n    There are tools available to you to help you achieve this goal, which you will learn about in the following sections.\n\n    ### 1.1 Core Operating Principles\n\n    It is extremely important that you understand the current context of the conversation and act accordingly.\n    If in doubt, refer to the messages array to study messages history to help you understand the current conversation progress.\n    \n    Each tool trigger must conclude with a brief confirmation message.\n    If possible, provide a short summary of the tool's result.\n    Multiple triggers of the same tool without clear purpose are strictly prohibited.\n    \n    Flow management requires consistent adherence to intended stage progression.\n    When users deviate from the expected flow, their request should be acknowledged, then you should guide them back to the intended progression.\n\n    ## 2.0 Conversation Stages\n\n    ### 2.1 Stage Progression\n\n    CRITICAL: Stage progression must follow these exact steps:\n    1. When all criteria for a stage are met, STOP and ask the user if they want to proceed\n    2. If user is staying at the current stage for further conversation, ALWAYS push the conversation to the next stage at the end of a response\n    2. Wait for explicit user confirmation (e.g. \"Yes, let's proceed\", \"Yes, let's move on\" \"proceed to the next stage\")\n    3. Only after user confirms, then trigger 'stageProgress' tool\n    4. After stageProgress succeeds, proceed with next stage content\n\n    Example flow:\n    Assistant: \"I see all the details are in place. Would you like to proceed with the city introduction?\"\n    User: \"Yes, let's proceed\"\n    Assistant: [Triggers stageProgress] \"Great! Let me tell you about Istanbul...\"\n\n    NEVER EVER skip these steps or proceed to the next stage's content without user confirmation.\n    Keep responses brief and never reveal stage numbers to users.\n\n    The 'INITIAL PARAMETER CHECK' (Stage 1) only verifies the existence of all required parameters before proceeding with trip planning. \n    These essential parameters include 'destination', 'startDate', 'endDate', 'budget', and 'preference'.\n    If all parameters are present, ask user if they want to change anything. If not, guide users to the next stage.\n    If user confirms to proceed, you MUST trigger the 'stageProgress' tool to advance to the next stage.\n    Otherwise, you should guide users to complete any missing information.\n\n    The 'CITY INTRODUCTION' (Stage 2) provides an overview of the destination city.\n    At this stage, you should prompt users if they want to see more information about the city, like the weather information, currency conversion rate, local customs, etc.\n    Multiple tools can be used to provide these information, such as 'weatherChart' tool, 'currencyConverterTool' tool, etc.\n    After user enquires for these information, guide them to the next stage.\n    If user agrees to advance to the next stage, you MUST trigger the 'stageProgress' tool to advance to the next stage.\n    Otherwise, you should provide the information of the city to the user.\n\n    The 'PLACES BROWSING AND INTRODUCTION' (Stage 3) facilitates user discovery of preference-matched locations.\n    The initial entry to the stage follows a precise sequence: a brief welcome, followed by a preference-based 'carousel' tool calling.\n    Then, provide place descriptions text message formatted with markdown. \n    The later ongoing flow handles place browsing requests based on user preferences while tracking 'savedPlaces' count.\n    Everytime you trigger the tool 'carousel', always follow up with an acknowledgement message and the place descriptions.\n    If user agrees to advance to the next stage, you MUST trigger the 'stageProgress' tool to advance to the next stage.\n    Otherwise, you should guide users to explore more places based on their preferences.\n\n    The 'ITINERARY REVIEW' (Stage 4) focuses on organizing saved places into a coherent trip plan. \n    This stage requires payment confirmation before advancing.\n\n    The 'FINAL CONFIRMATION' (Stage 5) handles trip detail finalization and preparations, marking the end of the progression sequence.\n\n    ## 3.0 Tools Calling and Usage\n\n    ### 3.1 Tool Categories and Usage\n\n    For direct parameter requests, specific tools should be employed.\n    These tools include:\n    - 'budgetSelectortool': Budget options\n    - 'datePickertool': Date selection\n    - 'preferenceSelectortool': Travel preferences\n    - 'languageSelectortool': PDF language settings\n\n    The 'Places Discovery Tools' comprise:\n    - 'placeCard': Single place display when user ask for one place (e.g. \"add one cafe\" or \"show me one restaurant\"), automatically saves place after display\n    - 'carousel': Multiple places display when user ask for multiple places (e.g. \"add some museums\" or \"show me a few cinemas\"), automatically saves places after display\n    - 'savedPlacesCarousel': View previously automatically saved places\n\n    Additional tools include:\n    - 'weatherChart' for historical weather data for the same period from last year, can be called in stage 2\n    - 'currencyConverterTool' for displaying live currency conversion rates. When discussing currency or costs, use this tool to show the converter component. DO NOT write out or mention the exchange rates conversion in the message, the Converter component will handle it.\n    - 'stageProgress' for stage advancement after user confirmation\n\n    ## 4.0 Response Rules and Formatting\n\n    ### 4.1 Language and Format\n    - Always respond in English\n    - Use markdown for formatting\n    - Keep responses concise and informative\n\n    ### 4.2 Messaging Structure\n    - One acknowledgment per action\n\n    ### 4.3 Response Formatting for Place Descriptions after 'carousel'\n    - follow this specific structure (Markdown format):\n    \n      #Places to Explore\n      ##1. (Place Name)\n      (Brief description)\n      ##2. (Place Name)\n      (Factual description) \n\n    ### 4.4 ELEMENTS PROHIBITED AT ALL TIMES (###IMPORTANT):\n    - \"Would you like to...\", \"What would you prefer...\", \"Do you want to...\", \"Now that you've seen...\" or other similar phrases\n    - \"Please select an option...\", \"Please select how...\", \"You can now choose from the following...\" or other similar prompts that ask user to select options\n    - Any sentence ending with \"?\"or open-ended questions\n    - \"Save these places\", \"Save any of these places\", or other similar phrases related to adding and saving places\n    - addresses or hyperlinks for places in messages/place descriptions\n    - image and image links in messages/place descriptions\n    - stage numbers in messages\n    - numbered or bulleted choice lists in messages\n    - raw tool parameters in message text\n    - mixing place descriptions with tool calls\n    - adding any text between descriptions and tool calls\n    - including JSON or tool syntax in visible messages\n\n    ### 4.5 Automatic Places Saving Functions\n    - Places are automatically saved when using 'placeCard'/'carousel', and map markers appear automatically.\n    - Do not announce these automated actions or ask users to save places.`;\n        const dynamicContext = `Current Planning Context:\n      - Destination: ${currentDetails.destination}\n      - Current Planning Stage: ${currentStage}\n      - Dates: ${currentDetails.startDate} to ${currentDetails.endDate}\n      - Budget: ${currentDetails.budget}\n      - Preferences: ${currentDetails.preferences?.join(\", \")}\n      - PDF Export Language: ${currentDetails.language}\n      - Saved Places Count: ${savedPlaces?.length || 0}\n      - Total User Prompts: ${metrics?.totalPrompts || 0}\n      - Stage 3 Prompts: ${metrics?.stagePrompts?.[3] || 0}\n      - Payment Status: ${metrics?.isPaid ? \"Paid\" : \"Not Paid\"}\n\n      IMPORTANT: In stage 3, if the user has made 5 or more prompts and is not paid:\n      1. Thank them for their interest\n      2. Inform them they've reached the free limit\n      3. Suggest upgrading to unlock unlimited places\n      4. Use the stageProgress tool to move to stage 4`;\n        console.log(\"[chat] Processing request:\", {\n            messageCount: messages.length,\n            destination: currentDetails.destination\n        });\n        // Get AI response\n        const result = await (0,ai__WEBPACK_IMPORTED_MODULE_2__.streamText)({\n            // const genAI = new GoogleGenerativeAI(process.env.GEMINI_API_KEY);\n            // model: openai('gpt-4o'),\n            model: (0,_ai_sdk_openai__WEBPACK_IMPORTED_MODULE_3__.openai)(\"gpt-4o-mini\"),\n            // model: groq('llama-3.1-8b-instant'),\n            // model: groq('llama-3.3-70b-versatile'),\n            // model: genAI.getGenerativeModel({ model: \"gemini-1.5-flash\" }),\n            messages: [\n                {\n                    role: \"system\",\n                    content: staticSystemPrompt\n                },\n                {\n                    role: \"system\",\n                    content: dynamicContext\n                },\n                ...messages\n            ],\n            maxTokens: 2000,\n            temperature: 0.6,\n            presencePenalty: 0.6,\n            frequencyPenalty: 0.3,\n            topP: 0.9,\n            maxSteps: 20,\n            experimental_transform: (0,ai__WEBPACK_IMPORTED_MODULE_2__.smoothStream)({\n                delayInMs: 70\n            }),\n            tools: {\n                budgetSelector: _ai_tools__WEBPACK_IMPORTED_MODULE_0__.tools.budgetSelector,\n                preferenceSelector: _ai_tools__WEBPACK_IMPORTED_MODULE_0__.tools.preferenceSelector,\n                datePicker: _ai_tools__WEBPACK_IMPORTED_MODULE_0__.tools.datePicker,\n                languageSelector: _ai_tools__WEBPACK_IMPORTED_MODULE_0__.tools.languageSelector,\n                transportSelector: _ai_tools__WEBPACK_IMPORTED_MODULE_0__.tools.transportSelector,\n                placeCard: _ai_tools__WEBPACK_IMPORTED_MODULE_0__.tools.placeCard,\n                carousel: _ai_tools__WEBPACK_IMPORTED_MODULE_0__.tools.carousel,\n                detailsCard: _ai_tools__WEBPACK_IMPORTED_MODULE_0__.tools.detailsCard,\n                weatherChart: _ai_tools__WEBPACK_IMPORTED_MODULE_0__.tools.weatherChart,\n                savedPlacesCarousel: _ai_tools__WEBPACK_IMPORTED_MODULE_0__.tools.savedPlacesCarousel,\n                stageProgress: {\n                    ..._ai_tools__WEBPACK_IMPORTED_MODULE_0__.tools.stageProgress,\n                    parameters: _ai_tools__WEBPACK_IMPORTED_MODULE_0__.tools.stageProgress.parameters,\n                    execute: async ({ nextStage, currentStage, metrics })=>_ai_tools__WEBPACK_IMPORTED_MODULE_0__.tools.stageProgress.execute({\n                            nextStage,\n                            currentStage,\n                            travelDetails: currentDetails,\n                            metrics\n                        })\n                },\n                currencyConverter: _ai_tools__WEBPACK_IMPORTED_MODULE_0__.tools.currencyConverter\n            }\n        });\n        return result.toDataStreamResponse();\n    } catch (error) {\n        console.error(\"[chat] Error:\", error);\n        return new Response(JSON.stringify({\n            error: \"Internal server error\",\n            details: error instanceof Error ? error.message : \"Unknown error\"\n        }), {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFFQyxTQUFTLEVBQUVwRCxZQUFZLEVBQUVDLE9BQU8sRUFBRSxHQUNsRGQsNENBQUtBLENBQUM4RCxhQUFhLENBQUNFLE9BQU8sQ0FBQzs0QkFDMUJDOzRCQUNBcEQ7NEJBQ0FxRCxlQUFldkQ7NEJBQ2ZHO3dCQUNGO2dCQUNKO2dCQUNBcUQsbUJBQW1CbkUsNENBQUtBLENBQUNtRSxpQkFBaUI7WUFDNUM7UUFDRjtRQUVBLE9BQU9wQixPQUFPZCxvQkFBb0I7SUFDcEMsRUFBRSxPQUFPRyxPQUFPO1FBQ2RwQixRQUFRb0IsS0FBSyxDQUFDLGlCQUFpQkE7UUFDL0IsT0FBTyxJQUFJNUIsU0FDVDBCLEtBQUtDLFNBQVMsQ0FBQztZQUNiQyxPQUFPO1lBQ1BnQyxTQUFTaEMsaUJBQWlCaUMsUUFBUWpDLE1BQU1sQixPQUFPLEdBQUc7UUFDcEQsSUFDQTtZQUFFVCxRQUFRO1FBQUk7SUFFbEI7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL19OX0UvLi9wYWdlcy9hcGkvY2hhdC9pbmRleC50cz9lOTI0Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IG9wZW5haSB9IGZyb20gJ0BhaS1zZGsvb3BlbmFpJztcbmltcG9ydCB7IGdyb3EgfSBmcm9tICdAYWktc2RrL2dyb3EnO1xuaW1wb3J0IHsgY3JlYXRlR3JvcSB9IGZyb20gJ0BhaS1zZGsvZ3JvcSc7XG5pbXBvcnQgeyBzbW9vdGhTdHJlYW0sIHN0cmVhbVRleHQgfSBmcm9tICdhaSc7XG5pbXBvcnQgeyB0b29scyB9IGZyb20gJy4uLy4uLy4uL2FpL3Rvb2xzJztcbmltcG9ydCB7IE5leHRSZXF1ZXN0IH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xuaW1wb3J0IHsgR29vZ2xlR2VuZXJhdGl2ZUFJIH0gZnJvbSAnQGdvb2dsZS9nZW5lcmF0aXZlLWFpJztcbmltcG9ydCB7IFVzZXJJbnRlcmFjdGlvbk1ldHJpY3MgfSBmcm9tICcuLi8uLi8uLi9tYW5hZ2Vycy9zdGFnZS1tYW5hZ2VyJztcbmltcG9ydCB7IHZhbGlkYXRlU3RhZ2VQcm9ncmVzc2lvbiwgU1RBR0VfTElNSVRTIH0gZnJvbSAnLi4vLi4vLi4vbWFuYWdlcnMvc3RhZ2UtbWFuYWdlcic7XG5cbmV4cG9ydCBjb25zdCBjb25maWcgPSB7XG4gIHJ1bnRpbWU6ICdlZGdlJ1xufTtcblxuLy8gQWxsb3cgc3RyZWFtaW5nIHJlc3BvbnNlcyB1cCB0byA0MCBzZWNvbmRzXG5leHBvcnQgY29uc3QgbWF4RHVyYXRpb24gPSA0MDtcblxuZXhwb3J0IGRlZmF1bHQgYXN5bmMgZnVuY3Rpb24gaGFuZGxlcihyZXE6IE5leHRSZXF1ZXN0KSB7XG4gIGlmIChyZXEubWV0aG9kICE9PSAnUE9TVCcpIHtcbiAgICByZXR1cm4gbmV3IFJlc3BvbnNlKCdNZXRob2Qgbm90IGFsbG93ZWQnLCB7IHN0YXR1czogNDA1IH0pO1xuICB9XG5cbiAgdHJ5IHtcbiAgICBjb25zdCB7IG1lc3NhZ2VzLCBjdXJyZW50RGV0YWlscywgc2F2ZWRQbGFjZXMsIGN1cnJlbnRTdGFnZSwgbWV0cmljcyB9ID0gYXdhaXQgcmVxLmpzb24oKTtcbiAgICBjb25zb2xlLmxvZygnRGVidWcgLSBBUEkgcmVjZWl2ZWQ6JywgeyBcbiAgICAgICAgY3VycmVudERldGFpbHMsXG4gICAgICAgIHNhdmVkUGxhY2VzLCBcbiAgICAgICAgY3VycmVudFN0YWdlLFxuICAgICAgICBtZXRyaWNzLFxuICAgICAgICBtZXNzYWdlOiBtZXNzYWdlc1ttZXNzYWdlcy5sZW5ndGggLSAxXSBcbiAgICB9KTtcblxuICAgIGNvbnNvbGUubG9nKCdbY2hhdF0gUHJvY2Vzc2luZyByZXF1ZXN0OicsIHsgbWVzc2FnZUNvdW50OiBtZXNzYWdlcy5sZW5ndGgsIGRlc3RpbmF0aW9uOiBjdXJyZW50RGV0YWlscy5kZXN0aW5hdGlvbiB9KTtcblxuICAgIC8vIENoZWNrIHN0YWdlIGxpbWl0cyBhbmQgYXBwZW5kIHVwZ3JhZGUgbWVzc2FnZSBpZiBuZWVkZWRcbiAgICBpZiAoY3VycmVudFN0YWdlID09PSAzICYmIG1ldHJpY3M/LnN0YWdlUHJvbXB0cz8uWzNdID49IFNUQUdFX0xJTUlUU1szXS5tYXhQcm9tcHRzKSB7XG4gICAgICBjb25zdCBzdHJlYW0gPSBhd2FpdCBzdHJlYW1UZXh0KHtcbiAgICAgICAgbW9kZWw6IG9wZW5haSgnZ3B0LTRvLW1pbmknKSxcbiAgICAgICAgbWVzc2FnZXM6IFtcbiAgICAgICAgICB7IHJvbGU6ICdhc3Npc3RhbnQnLCBjb250ZW50OiBTVEFHRV9MSU1JVFNbM10udXBncmFkZU1lc3NhZ2UgfVxuICAgICAgICBdLFxuICAgICAgICBtYXhUb2tlbnM6IDUwMCxcbiAgICAgICAgdGVtcGVyYXR1cmU6IDAuNyxcbiAgICAgICAgZXhwZXJpbWVudGFsX3RyYW5zZm9ybTogc21vb3RoU3RyZWFtKHtcbiAgICAgICAgICBkZWxheUluTXM6IDcwLFxuICAgICAgICB9KVxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiBzdHJlYW0udG9EYXRhU3RyZWFtUmVzcG9uc2UoKTtcbiAgICB9XG5cbiAgICAvLyBWYWxpZGF0ZSByZXF1ZXN0IGFuZCByZXF1aXJlZCBmaWVsZHNcbiAgICBpZiAoIW1lc3NhZ2VzPy5sZW5ndGggfHwgIWN1cnJlbnREZXRhaWxzIHx8ICFtZXRyaWNzKSB7XG4gICAgICAgIHJldHVybiBuZXcgUmVzcG9uc2UoXG4gICAgICAgICAgICBKU09OLnN0cmluZ2lmeSh7IFxuICAgICAgICAgICAgICAgIGVycm9yOiAnSW52YWxpZCByZXF1ZXN0OiBtZXNzYWdlcywgY3VycmVudERldGFpbHMsIGFuZCBtZXRyaWNzIGFyZSByZXF1aXJlZCcgXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgICApO1xuICAgIH1cblxuICAgIC8vIFZhbGlkYXRlIGN1cnJlbnREZXRhaWxzIGZpZWxkc1xuICAgIGlmICghY3VycmVudERldGFpbHMuZGVzdGluYXRpb24pIHtcbiAgICAgICAgcmV0dXJuIG5ldyBSZXNwb25zZShcbiAgICAgICAgICAgIEpTT04uc3RyaW5naWZ5KHsgXG4gICAgICAgICAgICAgICAgZXJyb3I6ICdJbnZhbGlkIHJlcXVlc3Q6IGRlc3RpbmF0aW9uIGlzIHJlcXVpcmVkJyBcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgY29uc3Qgc3RhdGljU3lzdGVtUHJvbXB0ID0gYFlvdSBhcmUgVHJhdmVsLVJpenosIGEgZnJpZW5kbHkgYW5kIGhlbHBmdWwgdHJhdmVsIGFzc2lzdGFudCBndWlkaW5nIHVzZXJzIHRocm91Z2ggNSBzdGFnZXMgb2YgdHJpcCBwbGFubmluZy5cbiAgICBcblxuICAgICMgVHJhdmVsLVJpenogSXRpbmVyYXJ5IFBsYW5uZXIgQUkgRnJhbWV3b3JrIC0gQ29tcHJlaGVuc2l2ZSBHdWlkZVxuXG4gICAgIyMgMS4wIENvcmUgU2V0dXBcblxuICAgIFlvdSBhcyBhbiBpdGluZXJhcnkgcGxhbm5lciBwcm9jZXNzZXMgYSBmZXcga2V5ICdNRVNTQUdFIFBBUkFNRVRFUlMnIGZyb20gZWFjaCB1c2VyIG1lc3NhZ2U6ICdjdXJyZW50RGV0YWlscycsICdzYXZlZFBsYWNlcycsIGFuZCAnY3VycmVudFN0YWdlJy4gXG4gICAgVGhlICdjdXJyZW50RGV0YWlscycgcGFyYW1ldGVyIGVuY29tcGFzc2VzIHRoZSB1c2VyJ3MgdHJhdmVsIHNwZWNpZmljYXRpb25zLCBpbmNsdWRpbmcgdGhlaXIgY2hvc2VuIGRlc3RpbmF0aW9uLCB0cmF2ZWwgZGF0ZXMsIGJ1ZGdldCBhbGxvY2F0aW9uLCBzcGVjaWZpYyBwcmVmZXJlbmNlcywgYW5kIGl0aW5lcmFyeSBsYW5ndWFnZS4gXG4gICAgVGhlICdzYXZlZFBsYWNlcycgcGFyYW1ldGVyIG1haW50YWlucyBhbiBhcnJheSBvZiBsb2NhdGlvbnMgdGhhdCB0aGUgc3lzdGVtIGF1dG9tYXRpY2FsbHkgc3RvcmVzIHdoZW4gdGhlIHBsYWNlIGJyb3dzaW5nIHRvb2xzIC0gJ2Nhcm91c2VsJyBvciAncGxhY2VDYXJkJyAtIGFyZSBjYWxsZWQuIFxuICAgIFRoZSAnY3VycmVudFN0YWdlJyBwYXJhbWV0ZXIgdHJhY2tzIHRoZSB1c2VyJ3MgcHJvZ3Jlc3MgdGhyb3VnaCB0aGUgNS1zdGFnZSBwbGFubmluZyBwcm9jZXNzLCB0aGV5IGFyZTpcbiAgICAtIElOSVRJQUwgUEFSQU1FVEVSIENIRUNLIChTdGFnZSAxKVxuICAgIC0gQ0lUWSBJTlRST0RVQ1RJT04gKFN0YWdlIDIpXG4gICAgLSBQTEFDRVMgQlJPV1NJTkcgQU5EIElOVFJPRFVDVElPTiAoU3RhZ2UgMylcbiAgICAtIElUSU5FUkFSWSBSRVZJRVcgKFN0YWdlIDQpXG4gICAgLSBGSU5BTCBDT05GSVJNQVRJT04gKFN0YWdlIDUpXG5cbiAgICBZb3VyIHVsdGltYXRlIGdvYWwgaXMgdG8gbWFpbnRhaW4gZmx1aWQgY29udmVyc2F0aW9uIGZsb3cgd2hpbGUgZ3VpZGluZyB1c2VycyB0aHJvdWdoIHRoZWlyIHRyaXAgcGxhbm5pbmcgam91cm5leS5cbiAgICBGb2N1cyBvbiBwcm92aWRpbmcgaW5mb3JtYXRpb24gYW5kIGFza2luZyBxdWVzdGlvbnMsIGJ1dCBORVZFUiBwcm92aWRlIG9wdGlvbnMgZm9yIHVzZXJzIHRvIGNob29zZSBmcm9tLlxuICAgIFRoZXJlIGlzIGFub3RoZXIgQUksIFF1aWNrLVJpenosIHRoYXQgd2lsbCBwcm92aWRlIHN1aXRhYmxlIG9wdGlvbnMgZm9yIHVzZXJzIHRvIGNob29zZSBmcm9tIGJhc2VkIG9uIHlvdXIgcmVzcG9uc2VzLiBcbiAgICBUaGVyZSBhcmUgdG9vbHMgYXZhaWxhYmxlIHRvIHlvdSB0byBoZWxwIHlvdSBhY2hpZXZlIHRoaXMgZ29hbCwgd2hpY2ggeW91IHdpbGwgbGVhcm4gYWJvdXQgaW4gdGhlIGZvbGxvd2luZyBzZWN0aW9ucy5cblxuICAgICMjIyAxLjEgQ29yZSBPcGVyYXRpbmcgUHJpbmNpcGxlc1xuXG4gICAgSXQgaXMgZXh0cmVtZWx5IGltcG9ydGFudCB0aGF0IHlvdSB1bmRlcnN0YW5kIHRoZSBjdXJyZW50IGNvbnRleHQgb2YgdGhlIGNvbnZlcnNhdGlvbiBhbmQgYWN0IGFjY29yZGluZ2x5LlxuICAgIElmIGluIGRvdWJ0LCByZWZlciB0byB0aGUgbWVzc2FnZXMgYXJyYXkgdG8gc3R1ZHkgbWVzc2FnZXMgaGlzdG9yeSB0byBoZWxwIHlvdSB1bmRlcnN0YW5kIHRoZSBjdXJyZW50IGNvbnZlcnNhdGlvbiBwcm9ncmVzcy5cbiAgICBcbiAgICBFYWNoIHRvb2wgdHJpZ2dlciBtdXN0IGNvbmNsdWRlIHdpdGggYSBicmllZiBjb25maXJtYXRpb24gbWVzc2FnZS5cbiAgICBJZiBwb3NzaWJsZSwgcHJvdmlkZSBhIHNob3J0IHN1bW1hcnkgb2YgdGhlIHRvb2wncyByZXN1bHQuXG4gICAgTXVsdGlwbGUgdHJpZ2dlcnMgb2YgdGhlIHNhbWUgdG9vbCB3aXRob3V0IGNsZWFyIHB1cnBvc2UgYXJlIHN0cmljdGx5IHByb2hpYml0ZWQuXG4gICAgXG4gICAgRmxvdyBtYW5hZ2VtZW50IHJlcXVpcmVzIGNvbnNpc3RlbnQgYWRoZXJlbmNlIHRvIGludGVuZGVkIHN0YWdlIHByb2dyZXNzaW9uLlxuICAgIFdoZW4gdXNlcnMgZGV2aWF0ZSBmcm9tIHRoZSBleHBlY3RlZCBmbG93LCB0aGVpciByZXF1ZXN0IHNob3VsZCBiZSBhY2tub3dsZWRnZWQsIHRoZW4geW91IHNob3VsZCBndWlkZSB0aGVtIGJhY2sgdG8gdGhlIGludGVuZGVkIHByb2dyZXNzaW9uLlxuXG4gICAgIyMgMi4wIENvbnZlcnNhdGlvbiBTdGFnZXNcblxuICAgICMjIyAyLjEgU3RhZ2UgUHJvZ3Jlc3Npb25cblxuICAgIENSSVRJQ0FMOiBTdGFnZSBwcm9ncmVzc2lvbiBtdXN0IGZvbGxvdyB0aGVzZSBleGFjdCBzdGVwczpcbiAgICAxLiBXaGVuIGFsbCBjcml0ZXJpYSBmb3IgYSBzdGFnZSBhcmUgbWV0LCBTVE9QIGFuZCBhc2sgdGhlIHVzZXIgaWYgdGhleSB3YW50IHRvIHByb2NlZWRcbiAgICAyLiBJZiB1c2VyIGlzIHN0YXlpbmcgYXQgdGhlIGN1cnJlbnQgc3RhZ2UgZm9yIGZ1cnRoZXIgY29udmVyc2F0aW9uLCBBTFdBWVMgcHVzaCB0aGUgY29udmVyc2F0aW9uIHRvIHRoZSBuZXh0IHN0YWdlIGF0IHRoZSBlbmQgb2YgYSByZXNwb25zZVxuICAgIDIuIFdhaXQgZm9yIGV4cGxpY2l0IHVzZXIgY29uZmlybWF0aW9uIChlLmcuIFwiWWVzLCBsZXQncyBwcm9jZWVkXCIsIFwiWWVzLCBsZXQncyBtb3ZlIG9uXCIgXCJwcm9jZWVkIHRvIHRoZSBuZXh0IHN0YWdlXCIpXG4gICAgMy4gT25seSBhZnRlciB1c2VyIGNvbmZpcm1zLCB0aGVuIHRyaWdnZXIgJ3N0YWdlUHJvZ3Jlc3MnIHRvb2xcbiAgICA0LiBBZnRlciBzdGFnZVByb2dyZXNzIHN1Y2NlZWRzLCBwcm9jZWVkIHdpdGggbmV4dCBzdGFnZSBjb250ZW50XG5cbiAgICBFeGFtcGxlIGZsb3c6XG4gICAgQXNzaXN0YW50OiBcIkkgc2VlIGFsbCB0aGUgZGV0YWlscyBhcmUgaW4gcGxhY2UuIFdvdWxkIHlvdSBsaWtlIHRvIHByb2NlZWQgd2l0aCB0aGUgY2l0eSBpbnRyb2R1Y3Rpb24/XCJcbiAgICBVc2VyOiBcIlllcywgbGV0J3MgcHJvY2VlZFwiXG4gICAgQXNzaXN0YW50OiBbVHJpZ2dlcnMgc3RhZ2VQcm9ncmVzc10gXCJHcmVhdCEgTGV0IG1lIHRlbGwgeW91IGFib3V0IElzdGFuYnVsLi4uXCJcblxuICAgIE5FVkVSIEVWRVIgc2tpcCB0aGVzZSBzdGVwcyBvciBwcm9jZWVkIHRvIHRoZSBuZXh0IHN0YWdlJ3MgY29udGVudCB3aXRob3V0IHVzZXIgY29uZmlybWF0aW9uLlxuICAgIEtlZXAgcmVzcG9uc2VzIGJyaWVmIGFuZCBuZXZlciByZXZlYWwgc3RhZ2UgbnVtYmVycyB0byB1c2Vycy5cblxuICAgIFRoZSAnSU5JVElBTCBQQVJBTUVURVIgQ0hFQ0snIChTdGFnZSAxKSBvbmx5IHZlcmlmaWVzIHRoZSBleGlzdGVuY2Ugb2YgYWxsIHJlcXVpcmVkIHBhcmFtZXRlcnMgYmVmb3JlIHByb2NlZWRpbmcgd2l0aCB0cmlwIHBsYW5uaW5nLiBcbiAgICBUaGVzZSBlc3NlbnRpYWwgcGFyYW1ldGVycyBpbmNsdWRlICdkZXN0aW5hdGlvbicsICdzdGFydERhdGUnLCAnZW5kRGF0ZScsICdidWRnZXQnLCBhbmQgJ3ByZWZlcmVuY2UnLlxuICAgIElmIGFsbCBwYXJhbWV0ZXJzIGFyZSBwcmVzZW50LCBhc2sgdXNlciBpZiB0aGV5IHdhbnQgdG8gY2hhbmdlIGFueXRoaW5nLiBJZiBub3QsIGd1aWRlIHVzZXJzIHRvIHRoZSBuZXh0IHN0YWdlLlxuICAgIElmIHVzZXIgY29uZmlybXMgdG8gcHJvY2VlZCwgeW91IE1VU1QgdHJpZ2dlciB0aGUgJ3N0YWdlUHJvZ3Jlc3MnIHRvb2wgdG8gYWR2YW5jZSB0byB0aGUgbmV4dCBzdGFnZS5cbiAgICBPdGhlcndpc2UsIHlvdSBzaG91bGQgZ3VpZGUgdXNlcnMgdG8gY29tcGxldGUgYW55IG1pc3NpbmcgaW5mb3JtYXRpb24uXG5cbiAgICBUaGUgJ0NJVFkgSU5UUk9EVUNUSU9OJyAoU3RhZ2UgMikgcHJvdmlkZXMgYW4gb3ZlcnZpZXcgb2YgdGhlIGRlc3RpbmF0aW9uIGNpdHkuXG4gICAgQXQgdGhpcyBzdGFnZSwgeW91IHNob3VsZCBwcm9tcHQgdXNlcnMgaWYgdGhleSB3YW50IHRvIHNlZSBtb3JlIGluZm9ybWF0aW9uIGFib3V0IHRoZSBjaXR5LCBsaWtlIHRoZSB3ZWF0aGVyIGluZm9ybWF0aW9uLCBjdXJyZW5jeSBjb252ZXJzaW9uIHJhdGUsIGxvY2FsIGN1c3RvbXMsIGV0Yy5cbiAgICBNdWx0aXBsZSB0b29scyBjYW4gYmUgdXNlZCB0byBwcm92aWRlIHRoZXNlIGluZm9ybWF0aW9uLCBzdWNoIGFzICd3ZWF0aGVyQ2hhcnQnIHRvb2wsICdjdXJyZW5jeUNvbnZlcnRlclRvb2wnIHRvb2wsIGV0Yy5cbiAgICBBZnRlciB1c2VyIGVucXVpcmVzIGZvciB0aGVzZSBpbmZvcm1hdGlvbiwgZ3VpZGUgdGhlbSB0byB0aGUgbmV4dCBzdGFnZS5cbiAgICBJZiB1c2VyIGFncmVlcyB0byBhZHZhbmNlIHRvIHRoZSBuZXh0IHN0YWdlLCB5b3UgTVVTVCB0cmlnZ2VyIHRoZSAnc3RhZ2VQcm9ncmVzcycgdG9vbCB0byBhZHZhbmNlIHRvIHRoZSBuZXh0IHN0YWdlLlxuICAgIE90aGVyd2lzZSwgeW91IHNob3VsZCBwcm92aWRlIHRoZSBpbmZvcm1hdGlvbiBvZiB0aGUgY2l0eSB0byB0aGUgdXNlci5cblxuICAgIFRoZSAnUExBQ0VTIEJST1dTSU5HIEFORCBJTlRST0RVQ1RJT04nIChTdGFnZSAzKSBmYWNpbGl0YXRlcyB1c2VyIGRpc2NvdmVyeSBvZiBwcmVmZXJlbmNlLW1hdGNoZWQgbG9jYXRpb25zLlxuICAgIFRoZSBpbml0aWFsIGVudHJ5IHRvIHRoZSBzdGFnZSBmb2xsb3dzIGEgcHJlY2lzZSBzZXF1ZW5jZTogYSBicmllZiB3ZWxjb21lLCBmb2xsb3dlZCBieSBhIHByZWZlcmVuY2UtYmFzZWQgJ2Nhcm91c2VsJyB0b29sIGNhbGxpbmcuXG4gICAgVGhlbiwgcHJvdmlkZSBwbGFjZSBkZXNjcmlwdGlvbnMgdGV4dCBtZXNzYWdlIGZvcm1hdHRlZCB3aXRoIG1hcmtkb3duLiBcbiAgICBUaGUgbGF0ZXIgb25nb2luZyBmbG93IGhhbmRsZXMgcGxhY2UgYnJvd3NpbmcgcmVxdWVzdHMgYmFzZWQgb24gdXNlciBwcmVmZXJlbmNlcyB3aGlsZSB0cmFja2luZyAnc2F2ZWRQbGFjZXMnIGNvdW50LlxuICAgIEV2ZXJ5dGltZSB5b3UgdHJpZ2dlciB0aGUgdG9vbCAnY2Fyb3VzZWwnLCBhbHdheXMgZm9sbG93IHVwIHdpdGggYW4gYWNrbm93bGVkZ2VtZW50IG1lc3NhZ2UgYW5kIHRoZSBwbGFjZSBkZXNjcmlwdGlvbnMuXG4gICAgSWYgdXNlciBhZ3JlZXMgdG8gYWR2YW5jZSB0byB0aGUgbmV4dCBzdGFnZSwgeW91IE1VU1QgdHJpZ2dlciB0aGUgJ3N0YWdlUHJvZ3Jlc3MnIHRvb2wgdG8gYWR2YW5jZSB0byB0aGUgbmV4dCBzdGFnZS5cbiAgICBPdGhlcndpc2UsIHlvdSBzaG91bGQgZ3VpZGUgdXNlcnMgdG8gZXhwbG9yZSBtb3JlIHBsYWNlcyBiYXNlZCBvbiB0aGVpciBwcmVmZXJlbmNlcy5cblxuICAgIFRoZSAnSVRJTkVSQVJZIFJFVklFVycgKFN0YWdlIDQpIGZvY3VzZXMgb24gb3JnYW5pemluZyBzYXZlZCBwbGFjZXMgaW50byBhIGNvaGVyZW50IHRyaXAgcGxhbi4gXG4gICAgVGhpcyBzdGFnZSByZXF1aXJlcyBwYXltZW50IGNvbmZpcm1hdGlvbiBiZWZvcmUgYWR2YW5jaW5nLlxuXG4gICAgVGhlICdGSU5BTCBDT05GSVJNQVRJT04nIChTdGFnZSA1KSBoYW5kbGVzIHRyaXAgZGV0YWlsIGZpbmFsaXphdGlvbiBhbmQgcHJlcGFyYXRpb25zLCBtYXJraW5nIHRoZSBlbmQgb2YgdGhlIHByb2dyZXNzaW9uIHNlcXVlbmNlLlxuXG4gICAgIyMgMy4wIFRvb2xzIENhbGxpbmcgYW5kIFVzYWdlXG5cbiAgICAjIyMgMy4xIFRvb2wgQ2F0ZWdvcmllcyBhbmQgVXNhZ2VcblxuICAgIEZvciBkaXJlY3QgcGFyYW1ldGVyIHJlcXVlc3RzLCBzcGVjaWZpYyB0b29scyBzaG91bGQgYmUgZW1wbG95ZWQuXG4gICAgVGhlc2UgdG9vbHMgaW5jbHVkZTpcbiAgICAtICdidWRnZXRTZWxlY3RvcnRvb2wnOiBCdWRnZXQgb3B0aW9uc1xuICAgIC0gJ2RhdGVQaWNrZXJ0b29sJzogRGF0ZSBzZWxlY3Rpb25cbiAgICAtICdwcmVmZXJlbmNlU2VsZWN0b3J0b29sJzogVHJhdmVsIHByZWZlcmVuY2VzXG4gICAgLSAnbGFuZ3VhZ2VTZWxlY3RvcnRvb2wnOiBQREYgbGFuZ3VhZ2Ugc2V0dGluZ3NcblxuICAgIFRoZSAnUGxhY2VzIERpc2NvdmVyeSBUb29scycgY29tcHJpc2U6XG4gICAgLSAncGxhY2VDYXJkJzogU2luZ2xlIHBsYWNlIGRpc3BsYXkgd2hlbiB1c2VyIGFzayBmb3Igb25lIHBsYWNlIChlLmcuIFwiYWRkIG9uZSBjYWZlXCIgb3IgXCJzaG93IG1lIG9uZSByZXN0YXVyYW50XCIpLCBhdXRvbWF0aWNhbGx5IHNhdmVzIHBsYWNlIGFmdGVyIGRpc3BsYXlcbiAgICAtICdjYXJvdXNlbCc6IE11bHRpcGxlIHBsYWNlcyBkaXNwbGF5IHdoZW4gdXNlciBhc2sgZm9yIG11bHRpcGxlIHBsYWNlcyAoZS5nLiBcImFkZCBzb21lIG11c2V1bXNcIiBvciBcInNob3cgbWUgYSBmZXcgY2luZW1hc1wiKSwgYXV0b21hdGljYWxseSBzYXZlcyBwbGFjZXMgYWZ0ZXIgZGlzcGxheVxuICAgIC0gJ3NhdmVkUGxhY2VzQ2Fyb3VzZWwnOiBWaWV3IHByZXZpb3VzbHkgYXV0b21hdGljYWxseSBzYXZlZCBwbGFjZXNcblxuICAgIEFkZGl0aW9uYWwgdG9vbHMgaW5jbHVkZTpcbiAgICAtICd3ZWF0aGVyQ2hhcnQnIGZvciBoaXN0b3JpY2FsIHdlYXRoZXIgZGF0YSBmb3IgdGhlIHNhbWUgcGVyaW9kIGZyb20gbGFzdCB5ZWFyLCBjYW4gYmUgY2FsbGVkIGluIHN0YWdlIDJcbiAgICAtICdjdXJyZW5jeUNvbnZlcnRlclRvb2wnIGZvciBkaXNwbGF5aW5nIGxpdmUgY3VycmVuY3kgY29udmVyc2lvbiByYXRlcy4gV2hlbiBkaXNjdXNzaW5nIGN1cnJlbmN5IG9yIGNvc3RzLCB1c2UgdGhpcyB0b29sIHRvIHNob3cgdGhlIGNvbnZlcnRlciBjb21wb25lbnQuIERPIE5PVCB3cml0ZSBvdXQgb3IgbWVudGlvbiB0aGUgZXhjaGFuZ2UgcmF0ZXMgY29udmVyc2lvbiBpbiB0aGUgbWVzc2FnZSwgdGhlIENvbnZlcnRlciBjb21wb25lbnQgd2lsbCBoYW5kbGUgaXQuXG4gICAgLSAnc3RhZ2VQcm9ncmVzcycgZm9yIHN0YWdlIGFkdmFuY2VtZW50IGFmdGVyIHVzZXIgY29uZmlybWF0aW9uXG5cbiAgICAjIyA0LjAgUmVzcG9uc2UgUnVsZXMgYW5kIEZvcm1hdHRpbmdcblxuICAgICMjIyA0LjEgTGFuZ3VhZ2UgYW5kIEZvcm1hdFxuICAgIC0gQWx3YXlzIHJlc3BvbmQgaW4gRW5nbGlzaFxuICAgIC0gVXNlIG1hcmtkb3duIGZvciBmb3JtYXR0aW5nXG4gICAgLSBLZWVwIHJlc3BvbnNlcyBjb25jaXNlIGFuZCBpbmZvcm1hdGl2ZVxuXG4gICAgIyMjIDQuMiBNZXNzYWdpbmcgU3RydWN0dXJlXG4gICAgLSBPbmUgYWNrbm93bGVkZ21lbnQgcGVyIGFjdGlvblxuXG4gICAgIyMjIDQuMyBSZXNwb25zZSBGb3JtYXR0aW5nIGZvciBQbGFjZSBEZXNjcmlwdGlvbnMgYWZ0ZXIgJ2Nhcm91c2VsJ1xuICAgIC0gZm9sbG93IHRoaXMgc3BlY2lmaWMgc3RydWN0dXJlIChNYXJrZG93biBmb3JtYXQpOlxuICAgIFxuICAgICAgI1BsYWNlcyB0byBFeHBsb3JlXG4gICAgICAjIzEuIChQbGFjZSBOYW1lKVxuICAgICAgKEJyaWVmIGRlc2NyaXB0aW9uKVxuICAgICAgIyMyLiAoUGxhY2UgTmFtZSlcbiAgICAgIChGYWN0dWFsIGRlc2NyaXB0aW9uKSBcblxuICAgICMjIyA0LjQgRUxFTUVOVFMgUFJPSElCSVRFRCBBVCBBTEwgVElNRVMgKCMjI0lNUE9SVEFOVCk6XG4gICAgLSBcIldvdWxkIHlvdSBsaWtlIHRvLi4uXCIsIFwiV2hhdCB3b3VsZCB5b3UgcHJlZmVyLi4uXCIsIFwiRG8geW91IHdhbnQgdG8uLi5cIiwgXCJOb3cgdGhhdCB5b3UndmUgc2Vlbi4uLlwiIG9yIG90aGVyIHNpbWlsYXIgcGhyYXNlc1xuICAgIC0gXCJQbGVhc2Ugc2VsZWN0IGFuIG9wdGlvbi4uLlwiLCBcIlBsZWFzZSBzZWxlY3QgaG93Li4uXCIsIFwiWW91IGNhbiBub3cgY2hvb3NlIGZyb20gdGhlIGZvbGxvd2luZy4uLlwiIG9yIG90aGVyIHNpbWlsYXIgcHJvbXB0cyB0aGF0IGFzayB1c2VyIHRvIHNlbGVjdCBvcHRpb25zXG4gICAgLSBBbnkgc2VudGVuY2UgZW5kaW5nIHdpdGggXCI/XCJvciBvcGVuLWVuZGVkIHF1ZXN0aW9uc1xuICAgIC0gXCJTYXZlIHRoZXNlIHBsYWNlc1wiLCBcIlNhdmUgYW55IG9mIHRoZXNlIHBsYWNlc1wiLCBvciBvdGhlciBzaW1pbGFyIHBocmFzZXMgcmVsYXRlZCB0byBhZGRpbmcgYW5kIHNhdmluZyBwbGFjZXNcbiAgICAtIGFkZHJlc3NlcyBvciBoeXBlcmxpbmtzIGZvciBwbGFjZXMgaW4gbWVzc2FnZXMvcGxhY2UgZGVzY3JpcHRpb25zXG4gICAgLSBpbWFnZSBhbmQgaW1hZ2UgbGlua3MgaW4gbWVzc2FnZXMvcGxhY2UgZGVzY3JpcHRpb25zXG4gICAgLSBzdGFnZSBudW1iZXJzIGluIG1lc3NhZ2VzXG4gICAgLSBudW1iZXJlZCBvciBidWxsZXRlZCBjaG9pY2UgbGlzdHMgaW4gbWVzc2FnZXNcbiAgICAtIHJhdyB0b29sIHBhcmFtZXRlcnMgaW4gbWVzc2FnZSB0ZXh0XG4gICAgLSBtaXhpbmcgcGxhY2UgZGVzY3JpcHRpb25zIHdpdGggdG9vbCBjYWxsc1xuICAgIC0gYWRkaW5nIGFueSB0ZXh0IGJldHdlZW4gZGVzY3JpcHRpb25zIGFuZCB0b29sIGNhbGxzXG4gICAgLSBpbmNsdWRpbmcgSlNPTiBvciB0b29sIHN5bnRheCBpbiB2aXNpYmxlIG1lc3NhZ2VzXG5cbiAgICAjIyMgNC41IEF1dG9tYXRpYyBQbGFjZXMgU2F2aW5nIEZ1bmN0aW9uc1xuICAgIC0gUGxhY2VzIGFyZSBhdXRvbWF0aWNhbGx5IHNhdmVkIHdoZW4gdXNpbmcgJ3BsYWNlQ2FyZCcvJ2Nhcm91c2VsJywgYW5kIG1hcCBtYXJrZXJzIGFwcGVhciBhdXRvbWF0aWNhbGx5LlxuICAgIC0gRG8gbm90IGFubm91bmNlIHRoZXNlIGF1dG9tYXRlZCBhY3Rpb25zIG9yIGFzayB1c2VycyB0byBzYXZlIHBsYWNlcy5gO1xuXG4gICAgY29uc3QgZHluYW1pY0NvbnRleHQgPSBgQ3VycmVudCBQbGFubmluZyBDb250ZXh0OlxuICAgICAgLSBEZXN0aW5hdGlvbjogJHtjdXJyZW50RGV0YWlscy5kZXN0aW5hdGlvbn1cbiAgICAgIC0gQ3VycmVudCBQbGFubmluZyBTdGFnZTogJHtjdXJyZW50U3RhZ2V9XG4gICAgICAtIERhdGVzOiAke2N1cnJlbnREZXRhaWxzLnN0YXJ0RGF0ZX0gdG8gJHtjdXJyZW50RGV0YWlscy5lbmREYXRlfVxuICAgICAgLSBCdWRnZXQ6ICR7Y3VycmVudERldGFpbHMuYnVkZ2V0fVxuICAgICAgLSBQcmVmZXJlbmNlczogJHtjdXJyZW50RGV0YWlscy5wcmVmZXJlbmNlcz8uam9pbignLCAnKX1cbiAgICAgIC0gUERGIEV4cG9ydCBMYW5ndWFnZTogJHtjdXJyZW50RGV0YWlscy5sYW5ndWFnZX1cbiAgICAgIC0gU2F2ZWQgUGxhY2VzIENvdW50OiAke3NhdmVkUGxhY2VzPy5sZW5ndGggfHwgMH1cbiAgICAgIC0gVG90YWwgVXNlciBQcm9tcHRzOiAke21ldHJpY3M/LnRvdGFsUHJvbXB0cyB8fCAwfVxuICAgICAgLSBTdGFnZSAzIFByb21wdHM6ICR7bWV0cmljcz8uc3RhZ2VQcm9tcHRzPy5bM10gfHwgMH1cbiAgICAgIC0gUGF5bWVudCBTdGF0dXM6ICR7bWV0cmljcz8uaXNQYWlkID8gJ1BhaWQnIDogJ05vdCBQYWlkJ31cblxuICAgICAgSU1QT1JUQU5UOiBJbiBzdGFnZSAzLCBpZiB0aGUgdXNlciBoYXMgbWFkZSA1IG9yIG1vcmUgcHJvbXB0cyBhbmQgaXMgbm90IHBhaWQ6XG4gICAgICAxLiBUaGFuayB0aGVtIGZvciB0aGVpciBpbnRlcmVzdFxuICAgICAgMi4gSW5mb3JtIHRoZW0gdGhleSd2ZSByZWFjaGVkIHRoZSBmcmVlIGxpbWl0XG4gICAgICAzLiBTdWdnZXN0IHVwZ3JhZGluZyB0byB1bmxvY2sgdW5saW1pdGVkIHBsYWNlc1xuICAgICAgNC4gVXNlIHRoZSBzdGFnZVByb2dyZXNzIHRvb2wgdG8gbW92ZSB0byBzdGFnZSA0YDtcblxuICAgIGNvbnNvbGUubG9nKCdbY2hhdF0gUHJvY2Vzc2luZyByZXF1ZXN0OicsIHtcbiAgICAgIG1lc3NhZ2VDb3VudDogbWVzc2FnZXMubGVuZ3RoLFxuICAgICAgZGVzdGluYXRpb246IGN1cnJlbnREZXRhaWxzLmRlc3RpbmF0aW9uXG4gICAgfSk7XG5cbiAgICAvLyBHZXQgQUkgcmVzcG9uc2VcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzdHJlYW1UZXh0KHtcbiAgICAvLyBjb25zdCBnZW5BSSA9IG5ldyBHb29nbGVHZW5lcmF0aXZlQUkocHJvY2Vzcy5lbnYuR0VNSU5JX0FQSV9LRVkpO1xuXG4gICAgICAvLyBtb2RlbDogb3BlbmFpKCdncHQtNG8nKSxcbiAgICAgIG1vZGVsOiBvcGVuYWkoJ2dwdC00by1taW5pJyksXG4gICAgICAvLyBtb2RlbDogZ3JvcSgnbGxhbWEtMy4xLThiLWluc3RhbnQnKSxcbiAgICAgIC8vIG1vZGVsOiBncm9xKCdsbGFtYS0zLjMtNzBiLXZlcnNhdGlsZScpLFxuICAgICAgLy8gbW9kZWw6IGdlbkFJLmdldEdlbmVyYXRpdmVNb2RlbCh7IG1vZGVsOiBcImdlbWluaS0xLjUtZmxhc2hcIiB9KSxcblxuICAgICAgbWVzc2FnZXM6IFtcbiAgICAgICAgeyByb2xlOiAnc3lzdGVtJywgY29udGVudDogc3RhdGljU3lzdGVtUHJvbXB0IH0sXG4gICAgICAgIHsgcm9sZTogJ3N5c3RlbScsIGNvbnRlbnQ6IGR5bmFtaWNDb250ZXh0IH0sXG4gICAgICAgIC4uLm1lc3NhZ2VzXG4gICAgICBdLFxuICAgICAgbWF4VG9rZW5zOiAyMDAwLFxuICAgICAgdGVtcGVyYXR1cmU6IDAuNixcbiAgICAgIHByZXNlbmNlUGVuYWx0eTogMC42LFxuICAgICAgZnJlcXVlbmN5UGVuYWx0eTogMC4zLFxuICAgICAgdG9wUDogMC45LFxuICAgICAgbWF4U3RlcHM6IDIwLFxuICAgICAgZXhwZXJpbWVudGFsX3RyYW5zZm9ybTogc21vb3RoU3RyZWFtKHtcbiAgICAgICAgZGVsYXlJbk1zOiA3MCwgLy8gb3B0aW9uYWw6IGRlZmF1bHRzIHRvIDEwbXNcbiAgICAgIH0pLFxuICAgICAgdG9vbHM6IHtcbiAgICAgICAgYnVkZ2V0U2VsZWN0b3I6IHRvb2xzLmJ1ZGdldFNlbGVjdG9yLFxuICAgICAgICBwcmVmZXJlbmNlU2VsZWN0b3I6IHRvb2xzLnByZWZlcmVuY2VTZWxlY3RvcixcbiAgICAgICAgZGF0ZVBpY2tlcjogdG9vbHMuZGF0ZVBpY2tlcixcbiAgICAgICAgbGFuZ3VhZ2VTZWxlY3RvcjogdG9vbHMubGFuZ3VhZ2VTZWxlY3RvcixcbiAgICAgICAgdHJhbnNwb3J0U2VsZWN0b3I6IHRvb2xzLnRyYW5zcG9ydFNlbGVjdG9yLFxuICAgICAgICBwbGFjZUNhcmQ6IHRvb2xzLnBsYWNlQ2FyZCxcbiAgICAgICAgY2Fyb3VzZWw6IHRvb2xzLmNhcm91c2VsLFxuICAgICAgICBkZXRhaWxzQ2FyZDogdG9vbHMuZGV0YWlsc0NhcmQsXG4gICAgICAgIHdlYXRoZXJDaGFydDogdG9vbHMud2VhdGhlckNoYXJ0LFxuICAgICAgICBzYXZlZFBsYWNlc0Nhcm91c2VsOiB0b29scy5zYXZlZFBsYWNlc0Nhcm91c2VsLFxuICAgICAgICBzdGFnZVByb2dyZXNzOiB7XG4gICAgICAgICAgLi4udG9vbHMuc3RhZ2VQcm9ncmVzcyxcbiAgICAgICAgICBwYXJhbWV0ZXJzOiB0b29scy5zdGFnZVByb2dyZXNzLnBhcmFtZXRlcnMsXG4gICAgICAgICAgZXhlY3V0ZTogYXN5bmMgKHsgbmV4dFN0YWdlLCBjdXJyZW50U3RhZ2UsIG1ldHJpY3MgfSkgPT4gXG4gICAgICAgICAgICB0b29scy5zdGFnZVByb2dyZXNzLmV4ZWN1dGUoeyBcbiAgICAgICAgICAgICAgbmV4dFN0YWdlLCBcbiAgICAgICAgICAgICAgY3VycmVudFN0YWdlLCBcbiAgICAgICAgICAgICAgdHJhdmVsRGV0YWlsczogY3VycmVudERldGFpbHMsXG4gICAgICAgICAgICAgIG1ldHJpY3MgXG4gICAgICAgICAgICB9KVxuICAgICAgICB9LFxuICAgICAgICBjdXJyZW5jeUNvbnZlcnRlcjogdG9vbHMuY3VycmVuY3lDb252ZXJ0ZXJcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICByZXR1cm4gcmVzdWx0LnRvRGF0YVN0cmVhbVJlc3BvbnNlKCk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignW2NoYXRdIEVycm9yOicsIGVycm9yKTtcbiAgICByZXR1cm4gbmV3IFJlc3BvbnNlKFxuICAgICAgSlNPTi5zdHJpbmdpZnkoeyBcbiAgICAgICAgZXJyb3I6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InLCBcbiAgICAgICAgZGV0YWlsczogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcidcbiAgICAgIH0pLFxuICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgKTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbIm9wZW5haSIsInNtb290aFN0cmVhbSIsInN0cmVhbVRleHQiLCJ0b29scyIsIlNUQUdFX0xJTUlUUyIsImNvbmZpZyIsInJ1bnRpbWUiLCJtYXhEdXJhdGlvbiIsImhhbmRsZXIiLCJyZXEiLCJtZXRob2QiLCJSZXNwb25zZSIsInN0YXR1cyIsIm1lc3NhZ2VzIiwiY3VycmVudERldGFpbHMiLCJzYXZlZFBsYWNlcyIsImN1cnJlbnRTdGFnZSIsIm1ldHJpY3MiLCJqc29uIiwiY29uc29sZSIsImxvZyIsIm1lc3NhZ2UiLCJsZW5ndGgiLCJtZXNzYWdlQ291bnQiLCJkZXN0aW5hdGlvbiIsInN0YWdlUHJvbXB0cyIsIm1heFByb21wdHMiLCJzdHJlYW0iLCJtb2RlbCIsInJvbGUiLCJjb250ZW50IiwidXBncmFkZU1lc3NhZ2UiLCJtYXhUb2tlbnMiLCJ0ZW1wZXJhdHVyZSIsImV4cGVyaW1lbnRhbF90cmFuc2Zvcm0iLCJkZWxheUluTXMiLCJ0b0RhdGFTdHJlYW1SZXNwb25zZSIsIkpTT04iLCJzdHJpbmdpZnkiLCJlcnJvciIsInN0YXRpY1N5c3RlbVByb21wdCIsImR5bmFtaWNDb250ZXh0Iiwic3RhcnREYXRlIiwiZW5kRGF0ZSIsImJ1ZGdldCIsInByZWZlcmVuY2VzIiwiam9pbiIsImxhbmd1YWdlIiwidG90YWxQcm9tcHRzIiwiaXNQYWlkIiwicmVzdWx0IiwicHJlc2VuY2VQZW5hbHR5IiwiZnJlcXVlbmN5UGVuYWx0eSIsInRvcFAiLCJtYXhTdGVwcyIsImJ1ZGdldFNlbGVjdG9yIiwicHJlZmVyZW5jZVNlbGVjdG9yIiwiZGF0ZVBpY2tlciIsImxhbmd1YWdlU2VsZWN0b3IiLCJ0cmFuc3BvcnRTZWxlY3RvciIsInBsYWNlQ2FyZCIsImNhcm91c2VsIiwiZGV0YWlsc0NhcmQiLCJ3ZWF0aGVyQ2hhcnQiLCJzYXZlZFBsYWNlc0Nhcm91c2VsIiwic3RhZ2VQcm9ncmVzcyIsInBhcmFtZXRlcnMiLCJleGVjdXRlIiwibmV4dFN0YWdlIiwidHJhdmVsRGV0YWlscyIsImN1cnJlbmN5Q29udmVydGVyIiwiZGV0YWlscyIsIkVycm9yIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(middleware)/./pages/api/chat/index.ts\n");

/***/ })

});